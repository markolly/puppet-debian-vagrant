# Puppet Module: puppet-debian_vagrant
This module is to provide initial configuration for Debian based Vagrant boxes running on Virtualbox generated by Packer.

## Dependencies

- puppetlabs-stdlib
- maestrodev-wget

## How to use with Packer

An example array of provisioners for your .json packer template file:
```
"provisioners": [
  {
    "type": "shell",
    "execute_command": "echo 'vagrant' | {{.Vars}} sudo -S -E bash '{{.Path}}'",
    "script": "scripts/puppet.sh"
  },
  {
    "type": "puppet-masterless",
    "puppet_bin_dir": "/usr/bin",
    "manifest_file": "puppet/manifests/default.pp",
    "module_paths": "puppet/modules",
    "ignore_exit_codes": true
  }
],
```

As an example for Ubuntu 18.04, these files should at minimum contain:

**scripts/puppet.sh**:

    #!/bin/bash -eux

    # Install Puppet.
    apt -y update && apt -y upgrade
    apt -y install puppet

**puppet/manifests/default.pp**:

    include debian_vagrant::base
    include debian_vagrant::ssh
    include debian_vagrant::vboxguest

## Packer Ubuntu 18.04 Example 
An example Packer build configuration to install Ubuntu 18.04 using Puppet for Virtualbox:
[markolly/packer-ubuntu1804](https://github.com/markolly/packer-ubuntu1804)

## Installation for development work
```
git clone git@github.com:markolly/puppet-debian_vagrant.git
cd puppet-debian_vagrant.git
bundle
ln -s ../../scripts/pre-commit.sh .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

To bypass pre-commit git hook tests run commits with the --no-verify option or -n flag. This is particularly useful when making changes to tests.

```
git commit -nm "Commit message"
```
